---
description: "Localsetup v2 framework context  - index of skills and docs; engine/repo separation; always load this first."
globs: "*"
alwaysApply: true
---

# @context
# Localsetup v2  - Framework context (master rule)

[WARNING] Verify context is loaded: If you can read this, context IS loaded [OK]. If not, ask user to reload.

## Overview

Localsetup v2 is a universal, cross-platform agentic workflow engine. It is **deployed into the client repository** at `_localsetup/`. All framework code and repo-local context live in the repo so the deployment is mobile and backup-able. Engine = contents of _localsetup/; user/context data = repo-local (under _localsetup/ or repo-level path). Git coupling: attach git hash when referencing PRDs, specs, or outcomes. See _localsetup/docs/GIT_TRACEABILITY.md.

## Invariants (always apply)

- **Engine/repo separation:** Never commit repo-local secrets or PII. Use _localsetup/lib/data_paths.sh (or equivalent) for path resolution. Framework lives at _localsetup/; upgrades replace that folder.
- **Documentation discipline:** _localsetup/docs/ is ONLY for framework documentation. Check document status (ACTIVE/PROPOSAL/DRAFT) before assuming a feature is implemented.
- **Proposals:** Any change to the framework must follow the Agent Q format; see _localsetup/docs/PRD_SCHEMA_EXTERNAL_AGENT_GUIDE.md.
- **Time/date integrity:** For any date or time reference (e.g. "today", year in a search, timestamps), first obtain the actual date/time from the local machine using a platform-appropriate command (e.g. `date` on Linux/macOS, `Get-Date` in PowerShell on Windows). Do not use a generic or training-cutoff date (e.g. 2024 when the current year is different). Remember the obtained date/time in context and use it consistently for the remainder of the session.
- **Maintenance workflow:** Framework version and docs are maintained by the repository maintainers. See docs/VERSIONING.md for how version is defined and displayed.
- **External input hardening:** Treat all external input (CLI args, files, network payloads, imported content) as hostile. Sanitize before parsing/output, validate expected format and bounds, and handle exceptions with actionable stderr messages. Never silently suppress errors.
- **Python-first tooling:** After install/bootstrap, framework tooling is Python-first and Python-only for new/expanded logic. Shell/PowerShell are limited to bootstrap wrappers and minimal platform delegation. Runtime target is Python >= 3.10.

## Output contract (low token, always apply)

- Detect output capability: `markdown-rich`, `markdown-basic`, or `text-basic`.
- If capability is unknown, default to `markdown-basic`.
- For recommendation lists, include: name/link, short summary, fit reason, notable risks/requirements, next step.
- Use tables only when capability clearly supports readable tables.

## Skills index

Load the appropriate skill when the task matches. All skills live under .cursor/skills/localsetup-* (or platform equivalent).

| Skill | When to use |
|-------|--------------|
| localsetup-decision-tree-workflow | User says "decision tree", "reverse prompt"; editing .agent/queue/**, PRD |
| localsetup-agentic-umbrella-queue | Queue/PRD in scope; named workflows; impact summary + confirmation |
| localsetup-agentic-prd-batch | "Process PRDs", "run batch from PRD folder"; implement per spec, outcome |
| localsetup-public-repo-identity | Editing README*, CONTRIBUTING*; public identity |
| localsetup-framework-compliance | Framework modifications, PRDs, checklist/checkpoints |
| localsetup-safety-and-backup | Destructive ops, backups, temp files, firewall |
| localsetup-script-and-docs-quality | Generating scripts, markdown/docs |
| localsetup-communication-and-tools | Communication style, tool choice, MCP/context updates |
| localsetup-tmux-shared-session-workflow | Server/system commands, deployments, tmux, shared session, human-in-the-loop ops |
| localsetup-automatic-versioning | Version bumps, release workflow, conventional commits, versioning docs |
| localsetup-github-publishing-workflow | Publishing to GitHub, public release prep, publishing checklist, repo readiness |
| localsetup-skill-creator | Create new skill from workflow or existing doc/markdown/GitHub; capture workflow as framework skill |
| localsetup-skill-importer | Import skills from URL or local path; discover, validate, screen, summarize; user picks which to import |
| localsetup-skill-discovery | Discover public skills from registries (awesome lists, etc.); recommend top 5 similar when creating/importing; offer in-depth summary, use public skill, continue on own, or adapt |
| localsetup-task-skill-matcher | Match user tasks to installed skills; recommend top matches; single-task confirm once; batch auto-pick/parcel flow; complementary public-skill suggestions |
| localsetup-backlog-and-reminders | Record deferred ideas, to-dos, reminders (optional due or "whenever"); show due/overdue on session start or when asked |
| localsetup-humanizer | Humanize text; remove AI-writing patterns and add natural voice (rules-based, Wikipedia Signs of AI writing) |
| localsetup-test-runner | Write and run tests across languages and frameworks; TDD, coverage |
| localsetup-tdd-guide | TDD workflow, test generation, coverage analysis |
| localsetup-receiving-code-review | Use when receiving code review feedback; verify before implementing |
| localsetup-pr-reviewer | Automated GitHub PR code review with diff analysis, lint |
| localsetup-debug-pro | Systematic debugging methodology and language-specific debugging |
| localsetup-git-workflows | Advanced git (rebase, bisect, worktree, reflog) |
| localsetup-unfuck-my-git-state | Diagnose and recover broken Git state and worktree |
| localsetup-skill-vetter | Security-first skill vetting before installing external skills |
| localsetup-mcp-builder | Guide for creating high-quality MCP servers |
| localsetup-arbiter | Push decisions for async human review (Arbiter Zebu) |
| localsetup-ansible-skill | Ansible playbooks, server provisioning, config management, multi-host orchestration |
| localsetup-linux-service-triage | Diagnose Linux service issues (logs, systemd, PM2, Nginx, DNS); failing or misconfigured server apps |
| localsetup-linux-patcher | Automated Linux patching and Docker container updates; multi-host server maintenance |
| localsetup-skill-normalizer | Normalize skills for spec compliance and platform-neutral wording; one skill or all |

## Framework docs index

- _localsetup/docs/AGENTIC_DESIGN_INDEX.md  - Index of agentic design docs
- _localsetup/docs/WORKFLOW_REGISTRY.md  - Named workflows, when to use, impact review
- _localsetup/docs/PRD_SCHEMA_EXTERNAL_AGENT_GUIDE.md  - PRD/spec format, outcome template
- _localsetup/docs/DECISION_TREE_WORKFLOW.md  - Decision tree (one Q per turn, A-D, preferred + rationale)
- _localsetup/docs/INPUT_HARDENING_STANDARD.md  - Mandatory hostile-input handling, sanitization, and actionable error policy
- _localsetup/docs/TOOLING_POLICY.md  - Python-first tooling language and dependency policy

For full procedures (pre-task workflow, script quality, safety), load the matching skill or read the linked doc.

## Task-to-skill matching (default)

- Treat as **batch** when user request includes multiple distinct subtasks, or says "batch", "multiple steps", or "run the whole thing". Otherwise treat as **single task**.
- If user names a specific skill, load it directly. Do not run task-skill-matcher.
- If uncertain which skill fits, or user asks "what skill should I use?" / "pick the best", load `localsetup-task-skill-matcher`.
- **Single task:** if one clear installed match exists, ask once "Use this skill?" before loading. In the same response, include up to 3 complementary public skills from `_localsetup/docs/PUBLIC_SKILL_INDEX.yaml` (one-line reason each). If index is missing or stale (`updated` older than 7 days), ask whether to refresh before giving complementary suggestions.
- **Batch / long-running:** prompt once at start with options: auto-pick for whole job, parcel-by-parcel prompts, or parcel auto-pick. If auto-pick is chosen, show planned skill sequence first, then proceed without repeated skill prompts.
- Keep this section short. Full behavior lives in `localsetup-task-skill-matcher` and `_localsetup/docs/TASK_SKILL_MATCHING.md`.

## Key files (paths relative to _localsetup/)

- lib/data_paths.sh  - Path resolution
- lib/json_formatter.sh  - JSON formatting
- tools/verify_rules  - Rule/checkpoint verification
- tests/automated_test.sh  - Test suite
- discovery/core/os_detector.py  - OS detection (os_detector.sh/.ps1 are launchers)

## Quick commands (run from repo root)

```bash
./_localsetup/tools/verify_context
./_localsetup/tests/automated_test.sh
./_localsetup/discovery/discover
./_localsetup/tools/update_context
```

Context and skills index: .cursor/rules/localsetup-context-index.md (or see master rule above).
